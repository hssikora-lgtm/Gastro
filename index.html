<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#1a2a6c">

<link rel="apple-touch-icon" href="https://emojicdn.elk.sh/üç¥">
<link rel="icon" href="https://emojicdn.elk.sh/üç¥">

<title>Gastro-Tracker</title>

<style>
:root { --primary:#ff6b6b; --secondary:#4ecdc4; }
body {
  font-family: Segoe UI, sans-serif;
  margin:0; padding:15px;
  background:linear-gradient(160deg,#1a2a6c,#b21f1f,#fdbb2d);
  color:white; min-height:100vh;
}
.container {
  background:rgba(0,0,0,.5);
  backdrop-filter:blur(15px);
  padding:20px;
  border-radius:25px;
  margin-bottom:20px;
}
/* Titel Zentrierung */
h2 { text-align: center; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }

.tabs { display:flex; gap:8px; overflow-x:auto; margin-bottom:15px; padding-bottom:5px; }
.tab {
  padding:8px 12px;
  border-radius:10px;
  background:rgba(255,255,255,.15);
  cursor:pointer;
  white-space:nowrap;
}
.tab.active { background:var(--primary); font-weight:bold; }

input, button {
  padding:15px;
  border-radius:12px;
  border:none;
  font-size:16px;
  width:100%;
  box-sizing:border-box;
  margin-bottom:10px;
}
input { background:white; color:#333; outline: none; }
#addBtn { background:var(--secondary); color:white; font-weight:bold; cursor:pointer; }

/* Buttons f√ºr Export/Import */
.io-row { display: flex; gap: 10px; margin-bottom: 15px; }
.io-btn { 
  background: rgba(255,255,255,0.2); 
  padding: 12px; 
  font-size: 14px; 
  margin-bottom: 0;
  cursor: pointer;
  border-radius: 12px;
  flex: 1;
  border: none;
  color: white;
  font-weight: bold;
}

.liste { max-height:240px; overflow-y:auto; margin-top: 10px; }
.eintrag {
  background:rgba(255,255,255,.12);
  padding:12px;
  border-radius:15px;
  margin-bottom:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.zeit { font-size:.75em; opacity:.8; margin-top: 3px; }

.gesamt-box {
  margin-top:10px;
  padding:15px;
  font-size:1.5em;
  font-weight:bold;
  text-align:center;
  border-radius:20px;
  background:rgba(255,255,255,.15);
  border: 1px solid var(--primary);
}

/* FIX F√úR DIE JAHRES√úBERSICHT */
.jahr-liste {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}
.jahr-item {
  background:rgba(255,255,255,.1);
  padding:10px 12px;
  border-radius:12px;
  display:flex;
  justify-content: space-between; /* Erzwingt den Abstand */
  align-items: center;
}
.jahr-item span { flex: 1; } /* Nimmt Platz links ein */
.jahr-item b { text-align: right; } /* Betrag klebt rechts */

.jahr-gesamt {
  grid-column:1/3;
  background:var(--primary);
  padding:15px;
  border-radius:15px;
  text-align:center;
  font-weight:bold;
  margin-top:10px;
}

.file-input { display: none; }
.footer { text-align:center; opacity:.5; margin-top:20px; font-size: 0.8em; }
.del-btn { width:auto; padding:5px 12px; margin:0; background:#ff4757; color: white; border-radius: 8px; border: none; cursor: pointer; }
</style>
</head>

<body>

<div class="container">
  <h2>üç¥ GASTRO-TRACKER</h2>
  <div class="tabs" id="monthTabs"></div>
  <input id="betrag" placeholder="Betrag ‚Ç¨" inputmode="decimal">
  <input id="ort" placeholder="Ort wird ermittelt ‚Ä¶">
  <button id="addBtn" onclick="speichern()">Hinzuf√ºgen</button>

  <div class="io-row">
    <button class="io-btn" onclick="exportTXT()">üì§ Export</button>
    <button class="io-btn" onclick="document.getElementById('importFile').click()">üì• Import</button>
    <input type="file" id="importFile" class="file-input" accept=".txt" onchange="importTXT(event)">
  </div>

  <div id="liste" class="liste"></div>
  <div id="gesamt" class="gesamt-box">0,00 ‚Ç¨</div>
</div>

<div class="container">
  <h3>üìä Jahres√ºbersicht</h3>
  <div id="jahrUebersicht" class="jahr-liste"></div>
</div>

<div class="footer">by HauniBauni</div>

<script>
const monate=["Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];
let aktuellerTab=new Date().getMonth();
let ausgaben=JSON.parse(localStorage.getItem("gastro_v_final")||"[]");

window.onload=()=>{ setupTabs(); anzeigen(); standort(); };

function standort(){
 if(!navigator.geolocation) { document.getElementById('ort').value="Wolfsegg"; return; }
 navigator.geolocation.getCurrentPosition(async pos=>{
  try{
   const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&addressdetails=1`);
   const data = await r.json();
   const a = data.address || {};
   let city = a.city || a.town || a.village || "Wolfsegg";
   if(JSON.stringify(a).toLowerCase().match(/kohlgrube|graben|wolfsegg/)) city="Wolfsegg";
   document.getElementById('ort').value = city;
  }catch{ document.getElementById('ort').value="Wolfsegg"; }
 },()=>document.getElementById('ort').value="Wolfsegg");
}

function setupTabs(){
 monthTabs.innerHTML="";
 monate.forEach((m,i)=>{
  const s=document.createElement("span");
  s.textContent=m;
  s.className="tab"+(i===aktuellerTab?" active":"");
  s.onclick=()=>{aktuellerTab=i;setupTabs();anzeigen();}
  monthTabs.appendChild(s);
 });
}

function speichern(){
 const b=parseFloat(betrag.value.replace(",",".")); 
 if(!b) return;
 const d=new Date();
 ausgaben.push({
  id:Date.now(),
  betrag:b,
  ort:ort.value,
  monat:aktuellerTab,
  zeit:d.toLocaleDateString("de-DE")+" "+d.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})
 });
 localStorage.setItem("gastro_v_final",JSON.stringify(ausgaben));
 betrag.value="";
 anzeigen();
}

function anzeigen(){
 liste.innerHTML="";
 jahrUebersicht.innerHTML="";
 let mSum=0,jSum=0;
 
 ausgaben.filter(a=>a.monat===aktuellerTab).reverse().forEach(a=>{
  mSum+=a.betrag;
  liste.innerHTML+=`<div class="eintrag"><div><b>${a.betrag.toFixed(2).replace(".",",")} ‚Ç¨</b><br><small>üìç ${a.ort}</small><div class="zeit">üìÖ ${a.zeit}</div></div><button class="del-btn" onclick="loeschen(${a.id})">X</button></div>`;
 });
 
 gesamt.textContent=`${monate[aktuellerTab]}: ${mSum.toFixed(2).replace(".",",")} ‚Ç¨`;
 
 monate.forEach((m,i)=>{
  const s=ausgaben.filter(a=>a.monat===i).reduce((x,a)=>x+a.betrag,0);
  jSum+=s;
  jahrUebersicht.innerHTML+=`<div class="jahr-item"><span>${m}</span><b>${s.toFixed(2).replace(".",",")} ‚Ç¨</b></div>`;
 });
 jahrUebersicht.innerHTML+=`<div class="jahr-gesamt">GESAMT ${new Date().getFullYear()}: ${jSum.toFixed(2).replace(".",",")} ‚Ç¨</div>`;
}

function loeschen(id){
 if(confirm("Eintrag l√∂schen?")){
  ausgaben=ausgaben.filter(a=>a.id!==id);
  localStorage.setItem("gastro_v_final",JSON.stringify(ausgaben));
  anzeigen();
 }
}

function exportTXT(){
 let txt="GASTRO-BACKUP\n";
 ausgaben.forEach(a=>txt+=`${a.zeit}|${a.betrag}|${a.ort}\n`);
 const blob=new Blob([txt],{type:"text/plain"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="gastro_backup.txt";
 a.click();
}

function importTXT(e){
 const f=e.target.files[0];
 if(!f) return;
 const r=new FileReader();
 r.onload=()=>{
  const zeilen = r.result.split("\n");
  zeilen.forEach(z=>{
   const p=z.split("|");
   if(p.length<3) return;
   ausgaben.push({ id:Date.now()+Math.random(), zeit:p[0], betrag:parseFloat(p[1]), ort:p[2], monat:parseInt(p[0].split(".")[1])-1 });
  });
  localStorage.setItem("gastro_v_final",JSON.stringify(ausgaben));
  anzeigen();
  alert("Import ok!");
 };
 r.readAsText(f);
}
</script>
</body>
</html>
